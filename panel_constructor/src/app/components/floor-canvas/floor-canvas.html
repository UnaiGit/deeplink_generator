<div #canvasContainer class="canvas-container">
  <canvas #floorCanvas></canvas>
  <!-- <div class="floor-info">
    <h3>{{ currentlyViewingLabelKey | translate }}: {{ ('floors.' + floorName()) | translate | titlecase }}</h3>
    <p>{{ floorData.messageKey | translate }}</p>
    <p>{{ floorData.tablesLabelKey | translate }}</p>
  </div> -->
  
  <!-- Zoom Controls - Hidden for kitchen floor -->
  @if (floorName() !== 'kitchen') {
    <div class="zoom-controls">
      <button class="zoom-button" (click)="zoomIn()" title="Zoom In" aria-label="Zoom In">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="11" y1="8" x2="11" y2="14"></line>
          <line x1="8" y1="11" x2="14" y2="11"></line>
        </svg>
      </button>
      <button class="zoom-button" (click)="zoomOut()" title="Zoom Out" aria-label="Zoom Out">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="8" y1="11" x2="14" y2="11"></line>
        </svg>
      </button>
      <button class="zoom-button" (click)="resetZoom()" title="Reset Zoom" aria-label="Reset Zoom">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
          <path d="M21 3v5h-5"></path>
          <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
          <path d="M3 21v-5h5"></path>
        </svg>
      </button>
      <div class="zoom-level">{{ Math.round(zoomLevel() * 100) }}%</div>
    </div>
  }

  @if (floorName() === 'kitchen') {
    <div class="kitchen-controls">
      <button 
        type="button" 
        class="build-toggle-button"
        [class.active]="kitchenBuildMode()"
        (click)="toggleKitchenBuildMode()" 
        title="Toggle Build Mode"
        aria-label="Toggle Build Mode">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
          <path d="M2 17l10 5 10-5"></path>
          <path d="M2 12l10 5 10-5"></path>
        </svg>
        <span>Build</span>
      </button>
    <div class="kitchen-carousel-buttons">
      <button type="button" (click)="showPreviousKitchenItem()" aria-label="Previous kitchen section">▲</button>
      <button type="button" (click)="showNextKitchenItem()" aria-label="Next kitchen section">▼</button>
      </div>
    </div>
  }

  <app-table-info
    [table]="hoveredTable()"
    [visible]="(isTableHovered() && floorName() === 'kitchen' && !kitchenBuildMode()) || (isTableHovered() && floorName() !== 'kitchen')"
    [x]="tooltipX()"
    [y]="tooltipY()"
  />

  <app-micro-tooltip
    [kitchenItem]="hoveredKitchenItem()"
    [visible]="isKitchenItemHovered() && floorName() === 'kitchen'"
    [x]="kitchenTooltipX()"
    [y]="kitchenTooltipY()"
  />

  <!-- Kitchen items rendered as HTML elements above canvas -->
  @if (floorName() === 'kitchen') {
    @for (item of kitchenItems(); track item.id) {
      <div 
        class="kitchen-item-card"
        [class.selected]="selectedKitchenItemId() === item.id"
        [style.left.px]="canvasToScreenX(item.x)"
        [style.top.px]="canvasToScreenY(item.y)"
        [style.width.px]="item.width * zoomLevel()"
        [style.height.px]="item.height * zoomLevel()"
        (mouseenter)="onKitchenItemMouseEnter(item, $event)"
        (mouseleave)="onKitchenItemMouseLeave()"
        (click)="onKitchenItemClick(item)">
        <div class="kitchen-item-pill">{{ item.departmentName || item.label }}</div>
        <div 
          class="kitchen-item-image-container"
          [style.height.px]="360 * zoomLevel()">
          @if (isKitchenImageLoaded(item.id)) {
            <img 
              [src]="getKitchenImageSrc(item.id)" 
              [alt]="item.departmentName || item.label"
              class="kitchen-item-image" />
          } @else {
            <div class="kitchen-item-placeholder">Loading…</div>
          }
        </div>
        @if (item.assignedEmployees && item.assignedEmployees.length > 0) {
          <div class="kitchen-item-employees">
            @for (employeeId of item.assignedEmployees; track employeeId) {
              @if (employeeService.getEmployeeById(employeeId); as employee) {
                <div 
                  class="kitchen-item-employee-avatar"
                  [style.background]="employee.avatarGradient || 'var(--gray-200)'">
                  {{ employee.initials }}
                </div>
              }
            }
          </div>
        }
      </div>
    }
  }

  @if (isTableConfigOpen) {
    <app-table-config-panel
      [table]="tableConfigTable"
      [step]="tableConfigStep"
      [configData]="tableConfigData"
      [gridSizeOptions]="gridSizeOptions"
      [capacityRange]="capacityRange"
      [nfcState]="nfcState"
      [isNfcComplete]="isNfcComplete"
      (cancel)="cancelTableConfig()"
      (configChange)="onTableConfigChange()"
      (continueToNfc)="continueToNfcStep()"
      (backToDetails)="backToDetails()"
      (save)="completeNfcSetup()"
      (readUid)="startReadUid()"
      (writePayload)="writePayload()"
      (testTap)="testNfcTap()"
    />
  }
</div>