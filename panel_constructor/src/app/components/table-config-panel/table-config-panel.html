<div class="table-config-overlay" (click)="$event.stopPropagation()">
  <div class="table-config-backdrop" (click)="cancel.emit(); $event.stopPropagation()"></div>
  <div class="table-config-panel" [class.nfc-step]="isNfcStep" (click)="$event.stopPropagation()">
    <header class="table-config-header">
      <div>
        <h3>{{ 'tableConfig.title' | translate:{ label: table?.label ?? '' } }}</h3>
        <p *ngIf="isDetailsStep">{{ 'tableConfig.detailsSubtitle' | translate }}</p>
        <p *ngIf="isNfcStep">{{ 'tableConfig.nfcSubtitle' | translate }}</p>
      </div>
      <button class="close-button" (click)="cancel.emit(); $event.stopPropagation()" aria-label="Close">
        Ã—
      </button>
    </header>

    <section class="table-config-content" *ngIf="isDetailsStep; else nfcStep">
      <div class="field-grid">
        <label>
          <span>{{ 'tableConfig.fields.width' | translate }}</span>
          <select
            [(ngModel)]="configData.width"
            (ngModelChange)="configChange.emit()"
          >
            <option *ngFor="let size of gridSizeOptions" [value]="size">{{ size }}</option>
          </select>
        </label>
        <label>
          <span>{{ 'tableConfig.fields.height' | translate }}</span>
          <select
            [(ngModel)]="configData.height"
            (ngModelChange)="configChange.emit()"
          >
            <option *ngFor="let size of gridSizeOptions" [value]="size">{{ size }}</option>
          </select>
        </label>
      </div>

      <div class="capacity-field">
        <div class="field-label">
          <span>{{ 'tableConfig.fields.capacity' | translate }}</span>
          <span class="suggested">{{ 'tableConfig.fields.suggestedMax' | translate:{ value: capacityRange.max } }}</span>
        </div>
        <input
          type="range"
          [min]="capacityRange.min"
          [max]="capacityRange.max"
          [(ngModel)]="configData.capacity"
          (ngModelChange)="configChange.emit()"
        />
        <div class="range-labels">
          <span>{{ 'tableConfig.fields.selected' | translate:{ value: configData.capacity } }}</span>
          <span>{{ capacityRange.max }}</span>
        </div>
      </div>

      <label class="max-stay-field">
        <span>{{ 'tableConfig.fields.maxStay' | translate }}</span>
        <input
          type="number"
          [placeholder]="'tableConfig.fields.maxStayPlaceholder' | translate"
          min="0"
          [(ngModel)]="configData.maxStay"
          (ngModelChange)="configChange.emit()"
        />
      </label>
    </section>

    <ng-template #nfcStep>
      <section class="nfc-step-content">
        <div class="nfc-step-item" [class.completed]="nfcState.read">
          <div class="step-info">
            <h4>{{ 'tableConfig.steps.read.title' | translate }}</h4>
            <p>
              {{ nfcState.read
                ? ('tableConfig.steps.read.complete' | translate)
                : ('tableConfig.steps.read.pending' | translate) }}
            </p>
          </div>
          <button
            class="primary"
            type="button"
            [disabled]="nfcState.read"
            (click)="readUid.emit()"
          >
            {{ nfcState.read
              ? ('tableConfig.buttons.done' | translate)
              : ('tableConfig.buttons.read' | translate) }}
          </button>
        </div>
        <div class="nfc-step-item" [class.completed]="nfcState.write">
          <div class="step-info">
            <h4>{{ 'tableConfig.steps.write.title' | translate }}</h4>
            <p>
              {{ nfcState.write
                ? ('tableConfig.steps.write.complete' | translate)
                : ('tableConfig.steps.write.pending' | translate) }}
            </p>
          </div>
          <button
            type="button"
            [disabled]="!nfcState.read || nfcState.write"
            (click)="writePayload.emit()"
          >
            {{ nfcState.write
              ? ('tableConfig.buttons.done' | translate)
              : ('tableConfig.buttons.write' | translate) }}
          </button>
        </div>
        <div class="nfc-step-item" [class.completed]="nfcState.test">
          <div class="step-info">
            <h4>{{ 'tableConfig.steps.test.title' | translate }}</h4>
            <p>
              {{ nfcState.test
                ? ('tableConfig.steps.test.complete' | translate)
                : ('tableConfig.steps.test.pending' | translate) }}
            </p>
          </div>
          <button
            type="button"
            [disabled]="!nfcState.read || !nfcState.write || nfcState.test"
            (click)="testTap.emit()"
          >
            {{ nfcState.test
              ? ('tableConfig.buttons.done' | translate)
              : ('tableConfig.buttons.test' | translate) }}
          </button>
        </div>
      </section>
    </ng-template>

    <footer class="table-config-footer">
      <button type="button" class="btn btn-neutral" (click)="cancel.emit(); $event.stopPropagation()">
        {{ 'tableConfig.buttons.cancel' | translate }}
      </button>
      <div class="actions">
        <button
          type="button"
          class="btn btn-neutral"
          *ngIf="isNfcStep"
          (click)="backToDetails.emit()"
        >
          {{ 'tableConfig.buttons.back' | translate }}
        </button>
        <button
          type="button"
          class="btn btn-primary"
          *ngIf="isDetailsStep"
          (click)="continueToNfc.emit()"
        >
          {{ 'tableConfig.buttons.continue' | translate }}
        </button>
        <button
          type="button"
          class="btn btn-primary"
          *ngIf="isNfcStep"
          [disabled]="!isNfcComplete"
          (click)="save.emit()"
        >
          {{ 'tableConfig.buttons.save' | translate }}
        </button>
      </div>
    </footer>
  </div>
</div>

