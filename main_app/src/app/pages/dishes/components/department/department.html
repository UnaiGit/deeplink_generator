<div class="department-manager">
  <div class="manager-header">
    <h2 class="manager-title">{{ 'Department Manager' | translate }}</h2>
    <button class="btn-add" (click)="openAddPanel()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2">
        <path d="M12 5v14M5 12h14" />
      </svg>
      {{ 'Add' | translate }}
    </button>
  </div>

  <div class="departments-grid">
    @for (dept of departments; track dept.id) {
    <div class="department-card">
      <div class="card-header">
        <div class="dept-title-row">
          <img class="dept-icon" [ngClass]="{'icon-invert': $first}"
            [src]="dept.icon" [alt]="dept.name" />
          <h3 class="dept-name">{{ dept.name | translate }}</h3>
          <span class="dept-badge">{{ dept.badge | translate }}</span>
        </div>
      </div>

      <div class="card-body">
        <p class="dept-staff">{{ 'Staff' | translate }} : {{ dept.staff }}</p>
        <p class="dept-capacity">{{ 'Capacity' | translate }}: {{ dept.capacity
          }}</p>
      </div>

      <div class="card-actions">
        <button class="btn-delete" (click)="deleteDepartment(dept.id)">
          <img src="/icons/refresh.svg" alt srcset>
          <span>{{ 'Delete' | translate }}</span>
        </button>
        <button class="btn-clear" (click)="clearTickets(dept.id)">
          {{ 'Clear tickets' | translate }}
        </button>
      </div>
    </div>
    }
  </div>
</div>

<!-- Add Department Side Panel -->
@if (showAddPanel()) {
<div class="side-panel-overlay"></div>
<div class="side-panel" (click)="$event.stopPropagation()">
  <div class="panel-header">
    <h3 class="panel-title">{{ 'New department' | translate }}</h3>
    <button class="btn-close" (click)="closeAddPanel()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2">
        <path d="M18 6L6 18M6 6l12 12" />
      </svg>
    </button>
  </div>

  <div class="panel-body">
    <div class="form-group">
      <label class="form-label">{{ 'Name' | translate }}</label>
      <div class="input-wrapper">
        <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24"
          fill="none" stroke="currentColor" stroke-width="2">
          <path
            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <input
          type="text"
          class="form-input"
          [(ngModel)]="newDepartment.name"
          [placeholder]="'ex : kitchen' | translate" />
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">{{ 'Icon' | translate }}</label>
      <div class="icon-selector">
        <div class="icon-dropdown-trigger"
          (click)="showIconDropdown = !showIconDropdown">
          <img class="selected-icon" [src]="newDepartment.icon"
            alt="Selected icon" />
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <path d="M6 9l6 6 6-6" />
          </svg>
        </div>

        @if (showIconDropdown) {
        <div class="icon-dropdown">
          @for (icon of icons; track icon) {
          <button class="icon-option" (click)="selectIcon(icon)">
            <img [src]="icon" alt="Icon" />
          </button>
          }
        </div>
        }

        <span class="separator">{{ 'or' | translate }}</span>

        <label class="btn-upload">
          <input type="file" hidden (change)="onFileSelected($event)"
            accept="image/*" />
          {{ 'Upload' | translate }}
        </label>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">{{ 'Capacity' | translate }}</label>
      <div class="input-wrapper">
        <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24"
          fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" />
          <path d="M9 9h6v6H9z" />
        </svg>
        <input
          type="number"
          class="form-input"
          [(ngModel)]="newDepartment.capacity"
          [placeholder]="'ex : 3' | translate" />
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">{{ 'Categories' | translate }}</label>
      <div class="input-wrapper">
        <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24"
          fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7" />
          <rect x="14" y="3" width="7" height="7" />
          <rect x="3" y="14" width="7" height="7" />
          <rect x="14" y="14" width="7" height="7" />
        </svg>
        <input
          type="text"
          class="form-input"
          [(ngModel)]="newDepartment.categories"
          [placeholder]="'with coma to separated' | translate" />
      </div>
    </div>
  </div>

  <div class="panel-footer">
    <button class="btn-save" (click)="saveDepartment()">
      {{ 'Save' | translate }}
    </button>
  </div>
</div>
}
