<app-base-modal
  [isOpen]="isOpen"
  [config]="modalConfig"
  (close)="onClose()">

  <div class="payment-modal-content">
    <!-- Header -->
    <div class="modal-header">
      <h2 class="modal-title">{{ 'Proceed to payment' | translate }}</h2>
      <button type="button" class="close-btn" (click)="onClose()">
        <img src="/icons/close.svg" alt="Close" />
      </button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      <!-- Split Section -->
      <div class="section split-section">
        <h3 class="section-title">{{ 'Split' | translate }}</h3>
        <div class="button-group">
          <button
            type="button"
            class="option-btn"
            [class.active]="splitType === 'one-pay'"
            (click)="onSplitTypeChange('one-pay')">
            {{ 'One pay' | translate }}
          </button>
          <button
            type="button"
            class="option-btn"
            [class.active]="splitType === '50-50'"
            (click)="onSplitTypeChange('50-50')">
            {{ '50/50' | translate }}
          </button>
          <button
            type="button"
            class="option-btn"
            [class.active]="splitType === 'divide-between'"
            (click)="onSplitTypeChange('divide-between')">
            {{ 'Divide between' | translate }}
          </button>
        </div>

        <!-- Number of People Selector -->
        <div class="people-selector" *ngIf="splitType === 'divide-between'">
          <label class="input-label">{{ 'Number of people' | translate
            }}</label>
          <select
            class="people-select"
            [(ngModel)]="numberOfPeople"
            (ngModelChange)="onNumberOfPeopleChange()">
            <option *ngFor="let num of peopleOptions" [value]="num">{{ num
              }}</option>
          </select>
        </div>

        <!-- Split Description -->
        <p class="split-description" *ngIf="getSplitDescription()">
          {{ getSplitDescription() }}
        </p>
      </div>

      <!-- Tip Section -->
      <div class="section tip-section">
        <h3 class="section-title">{{ 'Tip' | translate }}</h3>
        <div class="button-group">
          <button
            type="button"
            class="option-btn"
            [class.active]="tipType === 'no-tip'"
            (click)="onTipTypeChange('no-tip')">
            {{ 'No tip' | translate }}
          </button>
          <button
            *ngFor="let percentage of tipPercentages"
            type="button"
            class="option-btn"
            [class.active]="tipType === 'percentage' && selectedTipPercentage === percentage"
            (click)="onTipPercentageSelect(percentage)">
            {{ percentage }}%
          </button>
        </div>

        <!-- Custom Tip Input -->
        <div class="custom-tip-input">
          <input
            type="number"
            class="tip-input"
            placeholder="0"
            [(ngModel)]="customTipAmount"
            (ngModelChange)="onCustomTipChange()"
            [class.active]="tipType === 'custom'"
            min="0"
            step="0.01" />
          <span class="tip-symbol">%</span>
        </div>
      </div>

      <!-- Payment Method Section -->
      <div class="section payment-method-section">
        <h3 class="section-title">{{ 'Payment method' | translate }}</h3>
        <div class="payment-options">
          <label class="payment-option"
            [class.active]="paymentMethod === 'cash'">
            <input
              type="radio"
              name="paymentMethod"
              value="cash"
              [(ngModel)]="paymentMethod"
              (ngModelChange)="onPaymentMethodChange('cash')" />
            <div class="payment-option-content">
              <img src="/icons/cash.svg" alt="Cash" class="payment-icon" />
              <span>{{ 'Cash' | translate }}</span>
            </div>
          </label>

          <label class="payment-option"
            [class.active]="paymentMethod === 'card'">
            <input
              type="radio"
              name="paymentMethod"
              value="card"
              [(ngModel)]="paymentMethod"
              (ngModelChange)="onPaymentMethodChange('card')" />
            <div class="payment-option-content">
              <img src="/icons/card.svg" alt="Card" class="payment-icon" />
              <span>{{ 'Card' | translate }}</span>
            </div>
          </label>

          <label class="payment-option"
            [class.active]="paymentMethod === 'charge-to-room'">
            <input
              type="radio"
              name="paymentMethod"
              value="charge-to-room"
              [(ngModel)]="paymentMethod"
              (ngModelChange)="onPaymentMethodChange('charge-to-room')" />
            <div class="payment-option-content">
              <img src="/icons/room.svg" alt="Charge to room"
                class="payment-icon" />
              <span>{{ 'Charge to room' | translate }}</span>
            </div>
          </label>
        </div>
      </div>

      <!-- Summary Section -->
      <div class="section summary-section">
        <div class="summary-header">
          <h3 class="section-title">{{ 'Summary' | translate }}</h3>
          <button type="button" class="special-charge-link"
            (click)="onSpecialChargeClick()">
            {{ 'Special charge' | translate }} â†’
          </button>
        </div>

        <div class="summary-items">
          <div class="summary-item">
            <span class="summary-label">{{ 'Sub Total' | translate }}</span>
            <span class="summary-value">${{ paymentData?.subTotal?.toFixed(2)
              }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">{{ 'Discount' | translate }}</span>
            <span class="summary-value discount">-${{
              paymentData?.discount?.toFixed(2) }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">{{ 'Tax' | translate }} (10%)</span>
            <span class="summary-value">${{ paymentData?.tax?.toFixed(2)
              }}</span>
          </div>
          <div class="summary-item discount-applied"
            *ngIf="(paymentData?.discount || 0) > 0">
            <span class="summary-label discount-label">{{ 'Discount Applied' |
              translate }}</span>
            <span class="summary-icon">
              <img src="/icons/arrow-right.svg" alt=">" />
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer">
      <div class="total-section">
        <div class="total-row">
          <span class="total-label">{{ 'TOTAL' | translate }}</span>
          <span class="total-value">${{ finalTotal.toFixed(2) }}</span>
        </div>
        <p class="total-description" *ngIf="getSplitDescription()">
          {{ getSplitDescription() }}
        </p>
      </div>

      <div class="footer-actions">
        <button type="button" class="btn btn-secondary" (click)="onClose()">
          {{ 'Back' | translate }}
        </button>
        <button type="button" class="btn btn-primary" (click)="onConfirm()">
          {{ 'Confirm & close table' | translate }}
        </button>
      </div>
    </div>
  </div>
</app-base-modal>
