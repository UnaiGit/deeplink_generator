<div class="order-panel">
    <!-- Header -->
    <div class="panel-header">
        <div class="header-top">
            <div class="header-left">
                <div class="header-icon-wrapper">
                    <img src="/icons/tableicon.svg" alt="table"
                        class="header-icon" />
                </div>
                <div class="header-text">
                    <h2 class="table-title">{{ 'Table' | translate }} {{
                        tableNumber }}</h2>
                    <span class="clients-count"
                        *ngIf="clientsCount > 0 && !isLocked">
                        <span class="dot">â€¢</span>
                        <span>{{ clientsCount }} {{ 'clients' | translate
                            }}</span>
                    </span>
                </div>
            </div>
            <!-- Show "Select all" only when checkboxes are visible -->
            <div class="header-right"
                *ngIf="hasOrders && !isLocked && showCheckboxes()">
                <label class="select-all-label">
                    <input type="checkbox" [(ngModel)]="selectAllItems"
                        (change)="onSelectAllChange($event.target.checked)" />
                    <span>{{ 'Select all' | translate }}</span>
                </label>
            </div>
        </div>

        <!-- Client Selection Buttons - Only show when order is placed -->
        <div class="client-selection"
            *ngIf="!isLocked && orderState !== 'draft'">
            <button
                type="button"
                class="client-btn"
                [class.active]="isClientSelected('all')"
                (click)="onClientSelect('all')">
                {{ 'All' | translate }}
            </button>
            <button
                *ngFor="let client of clients"
                type="button"
                class="client-btn"
                [class.active]="isClientSelected(client.id)"
                (click)="onClientSelect(client.id)">
                <img *ngIf="client.avatar" [src]="client.avatar"
                    [alt]="client.name" class="client-avatar" />
                {{ client.name }}
            </button>
        </div>

        <!-- Status Indicators - Only show when order is placed and not all delivered -->
        <div class="status-indicators"
            *ngIf="orderState !== 'draft' && !allItemsDelivered() && (orderState === 'in-service' || tableStatus)"
            [class.centered]="isLocked">
            <!-- In Service Badge - Show when order is placed and in service -->
            <div class="status-badge in-service"
                *ngIf="orderState === 'in-service'">
                <img src="/icons/dish.svg" alt="In Service"
                    class="status-icon" />
                <span class="status-text">{{ 'In Service' | translate }}</span>
            </div>
            <!-- Sent to Kitchen Badge - Show when order is locked -->
            <div class="status-badge sent-to-kitchen"
                *ngIf="orderState === 'in-service' && isOrderLocked">
                <img src="/icons/cooking.svg" alt="Sent to kitchen"
                    class="status-icon" />
                <span class="status-text">{{ 'Sent to kitchen' | translate
                    }}</span>
            </div>
            <!-- Reserved Badge - Show only when table is reserved (before placing order) -->
            <div class="status-badge reserved"
                *ngIf="tableStatus === 'reserved' && !isOrderLocked">
                <img src="/icons/lock.svg" alt="Reserved" class="status-icon" />
                <span class="status-text">{{ 'Reserved' | translate }}</span>
            </div>
        </div>
    </div>

    <!-- Content Area (scrollable) -->
    <div class="panel-content">
        <!-- Locked State -->
        <div class="locked-state" *ngIf="isLocked">
            <div class="lock-icon-wrapper">
                <img src="/icons/lock.svg" alt="lock" class="lock-icon" />
            </div>
            <h3 class="locked-title">{{ 'This table is reserved' | translate
                }}</h3>
            <p class="locked-subtitle">{{ 'Unlock to start ordering.' |
                translate }}</p>
            <button
                class="unlock-btn-top"
                (click)="onUnlock()"
                type="button">
                {{ 'Unlock' | translate }}
            </button>
        </div>

        <!-- Empty State (when no orders and not locked) -->
        <div class="empty-state" *ngIf="!hasOrders && !isLocked">
            <div class="empty-illustration">
                <!-- Left Document -->
                <div class="document document-left">
                    <div class="doc-square"></div>
                    <div class="doc-line"></div>
                    <div class="doc-line"></div>
                    <div class="doc-checks">
                        <div class="check"></div>
                        <div class="check"></div>
                    </div>
                </div>

                <!-- Right Document -->
                <div class="document document-right">
                    <div class="doc-circles">
                        <div class="circle"></div>
                        <div class="circle"></div>
                        <div class="circle"></div>
                    </div>
                    <div class="doc-lines">
                        <div class="doc-line"></div>
                        <div class="doc-line"></div>
                    </div>
                </div>

                <!-- Magnifying Glass -->
                <div class="magnifying-glass">
                    <div class="glass-circle"></div>
                    <div class="glass-handle"></div>
                </div>
            </div>
            <p class="empty-text">{{ 'Not Ordered' | translate }}</p>
        </div>

        <!-- Order List (when orders exist and not table locked) -->
        <div class="order-list" *ngIf="hasOrders && !isLocked">
            <ng-container *ngFor="let category of getCategories()">
                <div class="category-section">
                    <div class="category-header">
                        <h4 class="category-title">{{ category }}</h4>
                        <span class="category-badge locked"
                            *ngIf="showLockedBadge()">
                            <img src="/icons/lock.svg" alt="Locked"
                                class="badge-icon" />
                            {{ 'Locked' | translate }}
                        </span>
                        <span class="category-badge open"
                            *ngIf="showOpenBadge()">
                            <img src="/icons/check-circle.svg" alt="Open"
                                class="badge-icon" />
                            {{ 'Open' | translate }}
                        </span>
                    </div>
                    <ng-container
                        *ngFor="let item of getItemsByCategory(category)">
                        <app-order-item
                            [title]="item.name"
                            [price]="item.price"
                            [image]="item.image"
                            [quantity]="item.quantity"
                            [status]="getItemStatus(item)"
                            [selected]="showCheckboxes() && isItemSelected(item.id)"
                            [clientName]="getClientNameForItem(item)"
                            [isLocked]="isOrderLocked"
                            (increment)="onIncrement(item)"
                            (decrement)="onDecrement(item)"
                            (remove)="onRemove(item)"
                            (selectedChange)="onItemSelectChange(item, $event)">
                        </app-order-item>
                    </ng-container>
                </div>
            </ng-container>
        </div>
    </div>

    <!-- Summary Section (Fixed at bottom) -->
    <div class="summary-section">
        <h3 class="summary-title">{{ 'Summary' | translate }}</h3>

        <!-- Coupon Input -->
        <div class="coupon-input-group">
            <div class="input-wrapper">
                <img src="/icons/coupan.svg" alt="tag" class="tag-icon" />
                <input
                    type="text"
                    class="coupon-input"
                    [(ngModel)]="couponCode"
                    [placeholder]="'Enter coupon code' | translate"
                    name="couponCode" />
            </div>
            <button class="apply-btn" (click)="applyCoupon()" type="button">
                {{ 'Apply' | translate }}
            </button>
        </div>

        <!-- Cost Breakdown -->
        <div class="cost-breakdown">
            <div class="cost-row">
                <span class="cost-label">{{ 'Sub Total' | translate
                    }}</span>
                <span class="cost-value">{{ hasOrders ? (subTotal |
                    currency:'USD':'symbol':'1.2-2') : '-' }}</span>
            </div>
            <div class="cost-row">
                <span class="cost-label">{{ 'Discount' | translate }}</span>
                <span class="cost-value">{{ hasOrders ? (discount |
                    currency:'USD':'symbol':'1.2-2') : '-' }}</span>
            </div>
            <div class="cost-row">
                <span class="cost-label">{{ 'Tax (10%)' | translate
                    }}</span>
                <span class="cost-value">{{ hasOrders ? (tax |
                    currency:'USD':'symbol':'1.2-2') : '-' }}</span>
            </div>
            <div class="cost-row total-row">
                <span class="cost-label">{{ 'TOTAL' | translate }}</span>
                <span class="cost-value">{{ hasOrders ? (total |
                    currency:'USD':'symbol':'1.2-2') : '-' }}</span>
            </div>
        </div>

        <!-- Discount Applied Badge -->
        <div class="discount-applied" *ngIf="discount > 0">
            <span>{{ 'Discount Applied' | translate }}</span>
            <img src="/icons/arrow-right.svg" alt="arrow"
                class="arrow-icon" />
        </div>
    </div>

    <!-- Mark All Delivered Button -->
    <button
        class="mark-delivered-btn"
        *ngIf="showMarkDelivered() && hasOrders && !isLocked"
        (click)="onMarkAllDelivered()"
        type="button">
        <img src="/icons/check-circle.svg" alt="check" class="btn-icon" />
        {{ 'Mark all delivered' | translate }}
    </button>

    <!-- Action Button -->
    <button
        class="place-order-btn"
        [class.disabled]="!hasOrders || total === 0 || isLocked"
        [disabled]="!hasOrders || total === 0 || isLocked"
        (click)="placeOrder()"
        type="button">
        {{ getButtonText() | translate }}
    </button>
</div>

<!-- Payment Modal -->
<app-payment-modal
    [isOpen]="showPaymentModal"
    [paymentData]="paymentModalData"
    (close)="onPaymentModalClose()"
    (confirm)="onPaymentConfirm($event)"
    (openSpecialCharge)="onOpenSpecialCharge()">
</app-payment-modal>

<!-- Special Charge Modal -->
<app-special-charge-modal
    [isOpen]="showSpecialChargeModal"
    [specialChargeData]="specialChargeModalData"
    (close)="onSpecialChargeModalClose()"
    (confirm)="onSpecialChargeConfirm($event)">
</app-special-charge-modal>
