<div class="modal-overlay" *ngIf="isOpen">
  <!-- Delete Confirmation Modal (Centered) -->
  <div
    *ngIf="isDeleteMode()"
    class="delete-modal-container"
    [class.open]="isOpen"
    (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <h2 class="modal-title">{{ getTitle() }}</h2>
      <button class="close-button" type="button" (click)="onClose()">×</button>
    </div>

    <!-- Content -->
    <div class="modal-content">
      <p class="delete-message">{{ getDeleteMessage() }}</p>
    </div>

    <!-- Footer -->
    <div class="modal-footer delete-footer">
      <button class="cancel-button" type="button"
        (click)="onClose()">Cancel</button>
      <button class="delete-button" type="button"
        (click)="onDelete()">Delete</button>
    </div>
  </div>

  <!-- Categories List View (Side Panel) -->
  <div
    *ngIf="showCategoriesList && !isDeleteMode()"
    class="modal-container"
    [class.open]="isOpen"
    (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <div class="header-left-group">
        <h2 class="modal-title">Add Category</h2>
        <button class="add-category-button" type="button" (click)="onOpenAdd()">
          <span class="add-icon">+</span>
          <span>Add category</span>
        </button>
      </div>
      <button class="close-button" type="button" (click)="onClose()">×</button>
    </div>

    <!-- Categories List Content -->
    <div class="modal-content categories-list-content">
      <!-- Add Category Form (shown at top when showAddFormInList is true) -->
      <div *ngIf="showAddFormInList" class="add-form-section">
        <!-- Name Field -->
        <div class="form-group">
          <label class="form-label">Name</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  fill="none" />
                <path
                  d="M4 6H12M4 9H10"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round" />
              </svg>
            </div>
            <input
              type="text"
              class="form-input"
              placeholder="ex : Meals"
              [(ngModel)]="formData.name" />
          </div>
        </div>

        <!-- Type and Icon Row -->
        <div class="form-row">
          <div class="form-group type-group">
            <label class="form-label">Type</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path
                    d="M8 2L10 6H14L11 9L12 13L8 11L4 13L5 9L2 6H6L8 2Z"
                    fill="currentColor" />
                </svg>
              </div>
              <select class="form-input" [(ngModel)]="formData.type">
                <option *ngFor="let type of typeOptions" [value]="type">{{ type
                  }}</option>
              </select>
              <div class="dropdown-arrow">▼</div>
            </div>
          </div>

          <div class="form-group icon-group">
            <label class="form-label">Icon</label>
            <div
              class="icon-circle"
              [style.background-color]="formData.icon ? '#4DD0E1' : '#e0f2fe'">
              <svg
                *ngIf="formData.icon === 'dish'"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="white">
                <path
                  d="M8.1 13.34l2.83-2.83L3.91 3.5c-1.56 1.56-1.56 4.09 0 5.66l4.19 4.18zm6.78-1.81c1.53.71 3.68.21 5.27-1.38 1.91-1.91 2.28-4.65.81-6.12-1.46-1.46-4.2-1.1-6.12.81-1.59 1.59-2.09 3.74-1.38 5.27L3.7 19.87l1.41 1.41L12 14.41l6.88 6.88 1.41-1.41L13.41 13l1.47-1.47z" />
              </svg>
              <svg
                *ngIf="formData.icon === 'category'"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="white">
                <path
                  d="M10 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2h-8l-2-2z" />
              </svg>
              <svg
                *ngIf="formData.icon === 'menu'"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="white">
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
              </svg>
              <svg
                *ngIf="!formData.icon"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="white">
                <path
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
              </svg>
            </div>
          </div>
        </div>

        <!-- Create Button -->
        <div class="add-form-actions">
          <button class="create-button" type="button" (click)="onSaveAddForm()">
            <span class="add-icon">+</span>
            <span>Create</span>
          </button>
        </div>
      </div>

      <div class="categories-label">Categories</div>
      <div class="categories-list">
        <div *ngFor="let category of categories" class="category-item">
          <div class="reorder-handle">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <circle cx="8" cy="6" r="1.5" />
              <circle cx="16" cy="6" r="1.5" />
              <circle cx="8" cy="12" r="1.5" />
              <circle cx="16" cy="12" r="1.5" />
              <circle cx="8" cy="18" r="1.5" />
              <circle cx="16" cy="18" r="1.5" />
            </svg>
          </div>
          <span class="category-name">{{ category.name }}</span>
          <div class="category-actions">
            <button class="edit-icon-button" type="button"
              (click)="onEditCategory(category)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path
                  d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                <path
                  d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
              </svg>
            </button>
            <button class="delete-icon-button" type="button"
              (click)="onDeleteCategory(category)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path
                  d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                <line x1="10" y1="11" x2="10" y2="17" />
                <line x1="14" y1="11" x2="14" y2="17" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="update-button" type="button"
        (click)="onUpdateCategories()">
        Update
      </button>
    </div>
  </div>

  <!-- Add/Edit Modal (Side Panel) -->
  <div
    *ngIf="!showCategoriesList && !isDeleteMode()"
    class="modal-container"
    [class.open]="isOpen"
    (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <h2 class="modal-title">{{ getTitle() }}</h2>
      <button class="close-button" type="button" (click)="onClose()">×</button>
    </div>

    <!-- Content -->
    <div class="modal-content">
      <!-- Name Field (always shown) -->
      <div class="form-group">
        <label class="form-label">Name</label>
        <div class="input-wrapper">
          <div class="input-icon">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path
                d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                stroke="currentColor"
                stroke-width="1.5"
                fill="none" />
              <path
                d="M4 6H12M4 9H10"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round" />
            </svg>
          </div>
          <input
            type="text"
            class="form-input"
            placeholder="ex : Meals"
            [(ngModel)]="formData.name" />
        </div>
      </div>

      <!-- Type and Icon Row (only for edit mode) -->
      <div class="form-row" *ngIf="mode === 'edit'">
        <div class="form-group type-group">
          <label class="form-label">Type</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M8 2L10 6H14L11 9L12 13L8 11L4 13L5 9L2 6H6L8 2Z"
                  fill="currentColor" />
              </svg>
            </div>
            <select class="form-input" [(ngModel)]="formData.type">
              <option *ngFor="let type of typeOptions" [value]="type">{{ type
                }}</option>
            </select>
            <div class="dropdown-arrow">▼</div>
          </div>
        </div>

        <div class="form-group icon-group">
          <label class="form-label">Icon</label>
          <div
            class="icon-circle"
            [style.background-color]="formData.icon ? '#4DD0E1' : '#e0f2fe'">
            <svg
              *ngIf="formData.icon === 'dish'"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="white">
              <path
                d="M8.1 13.34l2.83-2.83L3.91 3.5c-1.56 1.56-1.56 4.09 0 5.66l4.19 4.18zm6.78-1.81c1.53.71 3.68.21 5.27-1.38 1.91-1.91 2.28-4.65.81-6.12-1.46-1.46-4.2-1.1-6.12.81-1.59 1.59-2.09 3.74-1.38 5.27L3.7 19.87l1.41 1.41L12 14.41l6.88 6.88 1.41-1.41L13.41 13l1.47-1.47z" />
            </svg>
            <svg
              *ngIf="formData.icon === 'category'"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="white">
              <path
                d="M10 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2h-8l-2-2z" />
            </svg>
            <svg
              *ngIf="formData.icon === 'menu'"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="white">
              <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
            </svg>
            <svg
              *ngIf="!formData.icon"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="white">
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="save-button" type="button" (click)="onSave()">
        {{ getButtonText() }}
      </button>
    </div>
  </div>
</div>
