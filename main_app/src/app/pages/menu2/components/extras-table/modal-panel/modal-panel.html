<!-- Dual Panel View: Extra Group (Left) and Extra (Right) -->
<app-base-modal
  *ngIf="mode === 'add' && !isDeleteMode() && !showExtrasList"
  [isOpen]="isOpen"
  [config]="getModalConfig()"
  (close)="onClose()">
  <div class="dual-modal-container" (click)="$event.stopPropagation()">
    <!-- Extra Group Panel (Left) -->
    <div class="modal-panel left-panel">
      <!-- Header -->
      <div class="modal-header">
        <h2 class="modal-title">Extra Group</h2>
        <button class="close-button" type="button"
          (click)="onClose()">×</button>
      </div>

      <!-- Content -->
      <div class="modal-content">
        <!-- Name Field -->
        <div class="form-group">
          <label class="form-label">Name</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M8 2C6.9 2 6 2.9 6 4C6 5.1 6.9 6 8 6C9.1 6 10 5.1 10 4C10 2.9 9.1 2 8 2ZM8 7C6.34 7 4 7.67 4 9V10H12V9C12 7.67 9.66 7 8 7Z"
                  fill="currentColor" />
              </svg>
            </div>
            <input
              type="text"
              class="form-input"
              placeholder="ex : Sauces"
              [(ngModel)]="subcategoryData.name" />
          </div>
        </div>

        <!-- Format Field -->
        <div class="form-group format-group">
          <label class="form-label">Format</label>
          <div class="format-dropdown-wrapper">
            <div class="format-input-wrapper" (click)="toggleFormatDropdown()">
              <div class="input-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path
                    d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                    stroke="currentColor"
                    stroke-width="1.5"
                    fill="none" />
                  <path
                    d="M4 6H12M4 9H10"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round" />
                </svg>
              </div>
              <span class="format-display">{{ getFormatDisplayName() }}</span>
              <div class="dropdown-arrow"
                [class.open]="showFormatDropdown">▼</div>
            </div>
            <!-- Format Radio Buttons Dropdown -->
            <div class="format-dropdown" *ngIf="showFormatDropdown"
              (click)="$event.stopPropagation()">
              <label
                class="format-radio-option"
                [class.selected]="subcategoryData.format === 'Multiselector'"
                (click)="selectFormat('Multiselector')">
                <span class="format-radio-circle"
                  [class.filled]="subcategoryData.format === 'Multiselector'"></span>
                <span class="format-radio-label">Multi Selector</span>
              </label>
              <label
                class="format-radio-option"
                [class.selected]="subcategoryData.format === 'Single Selector'"
                (click)="selectFormat('Single Selector')">
                <span class="format-radio-circle"
                  [class.filled]="subcategoryData.format === 'Single Selector'"></span>
                <span class="format-radio-label">Single Selector</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Min and Max Fields Row -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Min</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path
                    d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                    stroke="currentColor"
                    stroke-width="1.5"
                    fill="none" />
                </svg>
              </div>
              <input
                type="text"
                class="form-input"
                placeholder="ex : 1"
                [(ngModel)]="subcategoryData.min" />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Min</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path
                    d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                    stroke="currentColor"
                    stroke-width="1.5"
                    fill="none" />
                </svg>
              </div>
              <input
                type="text"
                class="form-input"
                placeholder="ex : 10"
                [(ngModel)]="subcategoryData.max" />
            </div>
          </div>
        </div>

        <!-- Mandatory and Selected Items Section -->
        <div class="mandatory-selected-section">
          <!-- Mandatory Toggle (Top Right) -->
          <div class="mandatory-toggle-row">
            <div class="form-group mandatory-group">
              <label class="form-label">Mandatory</label>
              <div class="toggle-wrapper">
                <label class="toggle-switch">
                  <input type="checkbox"
                    [(ngModel)]="subcategoryData.mandatory" />
                  <span class="toggle-slider"
                    [class.active]="subcategoryData.mandatory"></span>
                </label>
              </div>
            </div>
          </div>

          <!-- Selected Items Section -->
          <div class="form-group selected-items-group">
            <div class="selected-items-container">
              <div *ngFor="let extra of selectedExtras"
                class="selected-item-tag">
                <span class="item-name">{{ extra }}</span>
                <button
                  class="remove-item-button"
                  type="button"
                  (click)="removeExtraFromList(extra)">
                  ×
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="modal-footer">
        <button class="add-subcategory-button" type="button"
          (click)="onSaveSubcategory()">
          Add subcategory
        </button>
      </div>
    </div>

    <!-- Extra Panel (Right) -->
    <div class="modal-panel right-panel">
      <!-- Header -->
      <div class="modal-header">
        <h2 class="modal-title">Extra</h2>
        <button class="close-button" type="button"
          (click)="onClose()">×</button>
      </div>

      <!-- Content -->
      <div class="modal-content">
        <!-- Name Field -->
        <div class="form-group">
          <label class="form-label">Name</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M8 2C6.9 2 6 2.9 6 4C6 5.1 6.9 6 8 6C9.1 6 10 5.1 10 4C10 2.9 9.1 2 8 2ZM8 7C6.34 7 4 7.67 4 9V10H12V9C12 7.67 9.66 7 8 7Z"
                  fill="currentColor" />
              </svg>
            </div>
            <input
              type="text"
              class="form-input"
              placeholder="ex : Sauces"
              [(ngModel)]="formData.name" />
          </div>
        </div>

        <!-- Price Field -->
        <div class="form-group">
          <label class="form-label">Price (in €)</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <span style="font-size: 14px; font-weight: 600">€</span>
            </div>
            <input
              type="number"
              class="form-input"
              placeholder="0"
              [(ngModel)]="formData.price"
              step="0.01"
              min="0" />
          </div>
        </div>

        <!-- Price Explanation -->
        <div class="form-group">
          <label class="form-label">Added to the dish price if selected</label>
          <div class="price-explanation-box">
            <ul class="price-rules">
              <li>Price = 0 → no additional price</li>
              <li>Price > 0 → the price goes up extra</li>
              <li>Price < 0 → for substitutions (permission-gated)</li>
            </ul>
          </div>
        </div>

        <!-- Allergens Section -->
        <div class="form-group">
          <label class="form-label">Allergens</label>
          <div class="allergens-grid">
            <div
              *ngFor="let allergen of allergens"
              class="allergen-item"
              [class.selected]="allergen.selected"
              (click)="toggleAllergen(allergen)">
              <div class="allergen-icon"
                [style.background-color]="allergen.color">
                <span class="allergen-icon-text">{{ allergen.icon }}</span>
                <span *ngIf="allergen.selected"
                  class="allergen-checkmark">✓</span>
              </div>
              <span class="allergen-name">{{ allergen.name }}</span>
            </div>
          </div>
        </div>

        <!-- Ingredient Section -->
        <div class="form-group">
          <label class="form-label">Ingredient</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <circle cx="7" cy="7" r="5" stroke="currentColor"
                  stroke-width="1.5" fill="none" />
                <path d="M11 11L14 14" stroke="currentColor" stroke-width="1.5"
                  stroke-linecap="round" />
              </svg>
            </div>
            <input
              type="text"
              class="form-input"
              placeholder="Vinegar (L)"
              [(ngModel)]="ingredientSearch" />
          </div>
        </div>

        <!-- Quantity and UoM Row -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Quantity</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path
                    d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                    stroke="currentColor"
                    stroke-width="1.5"
                    fill="none" />
                </svg>
              </div>
              <input
                type="text"
                class="form-input"
                placeholder="ex:23"
                [(ngModel)]="ingredientQuantity" />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">UoM</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path
                    d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                    stroke="currentColor"
                    stroke-width="1.5"
                    fill="none" />
                </svg>
              </div>
              <select class="form-input" [(ngModel)]="ingredientUom">
                <option *ngFor="let uom of uomOptions" [value]="uom">{{ uom
                  }}</option>
              </select>
              <div class="dropdown-arrow">▼</div>
            </div>
          </div>
        </div>

        <!-- Inventory Rule -->
        <div class="form-group">
          <label class="form-label">Inventory rule</label>
          <div class="radio-group">
            <label class="radio-option"
              [class.selected]="formData.inventoryRule === 'deducts'">
              <input
                type="radio"
                name="inventoryRule"
                value="deducts"
                [(ngModel)]="formData.inventoryRule" />
              <span class="radio-label">Deducts</span>
            </label>
            <label class="radio-option"
              [class.selected]="formData.inventoryRule === 'inform-only'">
              <input
                type="radio"
                name="inventoryRule"
                value="inform-only"
                [(ngModel)]="formData.inventoryRule" />
              <span class="radio-label">Inform-only</span>
            </label>
          </div>
        </div>

        <!-- Add Ingredient Button -->
        <div class="form-group">
          <button class="add-ingredient-button" type="button"
            (click)="addIngredient()">
            <span class="add-icon">+</span>
            <span>Add</span>
          </button>
        </div>

        <!-- Added Ingredients List -->
        <div class="form-group" *ngIf="formData.ingredients.length > 0">
          <div class="ingredients-list">
            <div *ngFor="let ingredient of formData.ingredients"
              class="ingredient-tag">
              <span class="ingredient-text">{{ ingredient.name }} ({{
                ingredient.quantity }}{{ ingredient.uom }})</span>
              <button
                class="remove-ingredient-button"
                type="button"
                (click)="removeIngredient(ingredient.id)">
                ×
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="modal-footer">
        <button class="save-button" type="button" (click)="onSave()">
          {{ getButtonText() }}
        </button>
      </div>
    </div>
  </div>
</app-base-modal>

<!-- Subcategory Modal (Side Panel) - For separate subcategory modal if needed -->
<app-base-modal
  *ngIf="showSubcategoryModal && !isDeleteMode() && mode !== 'add'"
  [isOpen]="isOpen"
  [config]="getModalConfig()"
  (close)="onCloseSubcategory(); close.emit()">
  <div (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <h2 class="modal-title">{{ getTitle() }}</h2>
      <button class="close-button" type="button"
        (click)="onCloseSubcategory(); close.emit()">×</button>
    </div>

    <!-- Content -->
    <div class="modal-content">
      <!-- Name Field -->
      <div class="form-group">
        <label class="form-label">Name</label>
        <div class="input-wrapper">
          <div class="input-icon">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path
                d="M8 2C6.9 2 6 2.9 6 4C6 5.1 6.9 6 8 6C9.1 6 10 5.1 10 4C10 2.9 9.1 2 8 2ZM8 7C6.34 7 4 7.67 4 9V10H12V9C12 7.67 9.66 7 8 7Z"
                fill="currentColor" />
            </svg>
          </div>
          <input
            type="text"
            class="form-input"
            placeholder="ex : Sauces"
            [(ngModel)]="subcategoryData.name" />
        </div>
      </div>

      <!-- Format Field -->
      <div class="form-group">
        <label class="form-label">Format</label>
        <div class="input-wrapper">
          <div class="input-icon">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path
                d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                stroke="currentColor"
                stroke-width="1.5"
                fill="none" />
              <path
                d="M4 6H12M4 9H10"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round" />
            </svg>
          </div>
          <select class="form-input" [(ngModel)]="subcategoryData.format">
            <option *ngFor="let format of formatOptions" [value]="format">{{
              format }}</option>
          </select>
          <div class="dropdown-arrow">▼</div>
        </div>
      </div>

      <!-- Min and Max Fields Row -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Min</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  fill="none" />
              </svg>
            </div>
            <input
              type="text"
              class="form-input"
              placeholder="ex : 1"
              [(ngModel)]="subcategoryData.min" />
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Max</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  fill="none" />
              </svg>
            </div>
            <input
              type="text"
              class="form-input"
              placeholder="ex : 10"
              [(ngModel)]="subcategoryData.max" />
          </div>
        </div>
      </div>

      <!-- Category and Mandatory Row -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Category</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  fill="none" />
                <path
                  d="M4 6H12M4 9H10"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round" />
              </svg>
            </div>
            <select class="form-input" [(ngModel)]="subcategoryData.category">
              <option value>ex : Meals</option>
              <option *ngFor="let category of categoryOptions"
                [value]="category">
                {{ category }}
              </option>
            </select>
            <div class="dropdown-arrow">▼</div>
          </div>
        </div>

        <div class="form-group mandatory-group">
          <label class="form-label">Mandatory</label>
          <div class="toggle-wrapper">
            <label class="toggle-switch">
              <input type="checkbox" [(ngModel)]="subcategoryData.mandatory" />
              <span class="toggle-slider"
                [class.active]="subcategoryData.mandatory"></span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="add-subcategory-button" type="button"
        (click)="onSaveSubcategory(); close.emit()">
        Add subcategory
      </button>
    </div>
  </div>
</app-base-modal>

<!-- Delete Confirmation Modal (Centered) -->
<app-base-modal
  *ngIf="isDeleteMode() && !showSubcategoryModal"
  [isOpen]="isOpen"
  [config]="getModalConfig()"
  (close)="onClose()">
  <div (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <h2 class="modal-title">{{ getTitle() }}</h2>
      <button class="close-button" type="button" (click)="onClose()">×</button>
    </div>

    <!-- Content -->
    <div class="modal-content">
      <p class="delete-message">{{ getDeleteMessage() }}</p>
    </div>

    <!-- Footer -->
    <div class="modal-footer delete-footer">
      <button class="cancel-button" type="button"
        (click)="onClose()">Cancel</button>
      <button class="delete-button" type="button"
        (click)="onDelete()">Delete</button>
    </div>
  </div>
</app-base-modal>

<!-- Extras List View (Side Panel) -->
<app-base-modal
  *ngIf="showExtrasList && !isDeleteMode()"
  [isOpen]="isOpen"
  [config]="getModalConfig()"
  (close)="onClose()">
  <div (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <h2 class="modal-title">{{ getTitle() }}</h2>
      <button class="close-button" type="button" (click)="onClose()">×</button>
    </div>

    <!-- Extras List Content -->
    <div class="modal-content extras-list-content">
      <div class="extras-container">
        <div
          *ngFor="let extra of availableExtras"
          class="extra-pill"
          [class.selected]="isExtraSelected(extra)">
          <span class="extra-name">{{ extra }}</span>
          <button
            class="remove-extra-button"
            type="button"
            (click)="removeExtraFromList(extra)">
            ×
          </button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="update-button" type="button" (click)="onUpdateExtras()">
        Update
      </button>
    </div>
  </div>
</app-base-modal>

<!-- Create/Edit Extra Modal (Side Panel) - For edit mode only -->
<app-base-modal
  *ngIf="mode === 'edit' && !showExtrasList && !isDeleteMode() && !showSubcategoryModal"
  [isOpen]="isOpen"
  [config]="getModalConfig()"
  (close)="onClose()">
  <div (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <h2 class="modal-title">{{ getTitle() }}</h2>
      <button class="close-button" type="button" (click)="onClose()">×</button>
    </div>

    <!-- Content -->
    <div class="modal-content">
      <!-- Name Field -->
      <div class="form-group">
        <label class="form-label">Name</label>
        <div class="input-wrapper">
          <div class="input-icon">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path
                d="M8 2C6.9 2 6 2.9 6 4C6 5.1 6.9 6 8 6C9.1 6 10 5.1 10 4C10 2.9 9.1 2 8 2ZM8 7C6.34 7 4 7.67 4 9V10H12V9C12 7.67 9.66 7 8 7Z"
                fill="currentColor" />
            </svg>
          </div>
          <input
            type="text"
            class="form-input"
            placeholder="ex : Sauces"
            [(ngModel)]="formData.name" />
        </div>
      </div>

      <!-- Format Field -->
      <div class="form-group">
        <label class="form-label">Format</label>
        <div class="input-wrapper">
          <div class="input-icon">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path
                d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                stroke="currentColor"
                stroke-width="1.5"
                fill="none" />
              <path
                d="M4 6H12M4 9H10"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round" />
            </svg>
          </div>
          <select class="form-input" [(ngModel)]="formData.format">
            <option *ngFor="let format of formatOptions" [value]="format">{{
              format }}</option>
          </select>
          <div class="dropdown-arrow">▼</div>
        </div>
      </div>

      <!-- Min and Max Fields Row -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Min</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  fill="none" />
              </svg>
            </div>
            <input
              type="text"
              class="form-input"
              placeholder="ex : 1"
              [(ngModel)]="formData.min" />
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Max</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  fill="none" />
              </svg>
            </div>
            <input
              type="text"
              class="form-input"
              placeholder="ex : 10"
              [(ngModel)]="formData.max" />
          </div>
        </div>
      </div>

      <!-- Category and Mandatory Row -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Category</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  fill="none" />
                <path
                  d="M4 6H12M4 9H10"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round" />
              </svg>
            </div>
            <select class="form-input" [(ngModel)]="formData.category">
              <option value>ex : Meals</option>
              <option *ngFor="let category of categoryOptions"
                [value]="category">
                {{ category }}
              </option>
            </select>
            <div class="dropdown-arrow">▼</div>
          </div>
        </div>

        <div class="form-group mandatory-group">
          <label class="form-label">Mandatory</label>
          <div class="toggle-wrapper">
            <label class="toggle-switch">
              <input type="checkbox" [(ngModel)]="formData.mandatory" />
              <span class="toggle-slider"
                [class.active]="formData.mandatory"></span>
            </label>
          </div>
        </div>
      </div>

      <!-- Price Field -->
      <div class="form-group">
        <label class="form-label">Price (in €)</label>
        <div class="input-wrapper">
          <div class="input-icon">
            <span style="font-size: 14px; font-weight: 600">€</span>
          </div>
          <input
            type="number"
            class="form-input"
            placeholder="0"
            [(ngModel)]="formData.price"
            step="0.01"
            min="0" />
        </div>
      </div>

      <!-- Price Explanation -->
      <div class="form-group">
        <label class="form-label">Added to the dish price if selected</label>
        <div class="price-explanation-box">
          <ul class="price-rules">
            <li>Price = 0 → no additional price</li>
            <li>Price > 0 → the price goes up extra</li>
            <li>Price < 0 → for substitutions (permission-gated)</li>
          </ul>
        </div>
      </div>

      <!-- Allergens Section -->
      <div class="form-group">
        <label class="form-label">Allergens</label>
        <div class="allergens-grid">
          <div
            *ngFor="let allergen of allergens"
            class="allergen-item"
            [class.selected]="allergen.selected"
            (click)="toggleAllergen(allergen)">
            <div class="allergen-icon"
              [style.background-color]="allergen.color">
              <span class="allergen-icon-text">{{ allergen.icon }}</span>
            </div>
            <span class="allergen-name">{{ allergen.name }}</span>
          </div>
        </div>
      </div>

      <!-- Ingredient Section -->
      <div class="form-group">
        <label class="form-label">Ingredient</label>
        <div class="input-wrapper">
          <div class="input-icon">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <circle cx="7" cy="7" r="5" stroke="currentColor"
                stroke-width="1.5" fill="none" />
              <path d="M11 11L14 14" stroke="currentColor" stroke-width="1.5"
                stroke-linecap="round" />
            </svg>
          </div>
          <input
            type="text"
            class="form-input"
            placeholder="Vinegar (L)"
            [(ngModel)]="ingredientSearch" />
        </div>
      </div>

      <!-- Quantity and UoM Row -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Quantity</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  fill="none" />
              </svg>
            </div>
            <input
              type="text"
              class="form-input"
              placeholder="ex:23"
              [(ngModel)]="ingredientQuantity" />
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">UoM</label>
          <div class="input-wrapper">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M13.5 2H2.5C1.67 2 1 2.67 1 3.5V12.5C1 13.33 1.67 14 2.5 14H13.5C14.33 14 15 13.33 15 12.5V3.5C15 2.67 14.33 2 13.5 2Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  fill="none" />
              </svg>
            </div>
            <select class="form-input" [(ngModel)]="ingredientUom">
              <option *ngFor="let uom of uomOptions" [value]="uom">{{ uom
                }}</option>
            </select>
            <div class="dropdown-arrow">▼</div>
          </div>
        </div>
      </div>

      <!-- Inventory Rule -->
      <div class="form-group">
        <label class="form-label">Inventory rule</label>
        <div class="radio-group">
          <label class="radio-option"
            [class.selected]="formData.inventoryRule === 'deducts'">
            <input
              type="radio"
              name="inventoryRule"
              value="deducts"
              [(ngModel)]="formData.inventoryRule" />
            <span class="radio-label">Deducts</span>
          </label>
          <label class="radio-option"
            [class.selected]="formData.inventoryRule === 'inform-only'">
            <input
              type="radio"
              name="inventoryRule"
              value="inform-only"
              [(ngModel)]="formData.inventoryRule" />
            <span class="radio-label">Inform-only</span>
          </label>
        </div>
      </div>

      <!-- Add Ingredient Button -->
      <div class="form-group">
        <button class="add-ingredient-button" type="button"
          (click)="addIngredient()">
          <span class="add-icon">+</span>
          <span>Add</span>
        </button>
      </div>

      <!-- Added Ingredients List -->
      <div class="form-group" *ngIf="formData.ingredients.length > 0">
        <div class="ingredients-list">
          <div *ngFor="let ingredient of formData.ingredients"
            class="ingredient-tag">
            <span class="ingredient-text">{{ ingredient.name }} ({{
              ingredient.quantity }}{{ ingredient.uom }})</span>
            <button
              class="remove-ingredient-button"
              type="button"
              (click)="removeIngredient(ingredient.id)">
              ×
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="add-subcategory-button" type="button"
        (click)="onAddSubcategory()">
        Add subcategory
      </button>
      <button class="save-button" type="button" (click)="onSave()">
        {{ getButtonText() }}
      </button>
    </div>
  </div>
</app-base-modal>
